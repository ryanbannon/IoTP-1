<html>
<head>
	<meta charset="UTF-8">
	<title>Sensor Data Highcharts</title>
   	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
   	<script src="http://code.highcharts.com/highcharts.js"></script>
		<script src="https://code.highcharts.com/highcharts-more.js"></script>
		<script src="http://dweet.io/client/dweet.io.min.js"></script>
</head>
<body>
<br><div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>
<br><br><div id="container2" style="width: 800px; height: 400px; margin: 0 auto"></div>
<br><br><div id="container3" style="width: 800px; height: 400px; margin: 0 auto"></div><br>
<script language="JavaScript">
//console.log(retrievedObjectdist[-5:])
var z;
for(z=0;z<1;z++){
	// Below code displays all localStorage objects in the console.
	console.log("HTML Local Storage:");
	var i;
	for (i = 0; i < localStorage.length; i++)   {
			console.log(localStorage.key(i) + "=[" + localStorage.getItem(localStorage.key(i)) + "]");
	}
}

var dist_data = []
var temp_data = []
var light_data = []
var data = []

$(document).ready(function () {
var name = 'ryan-iot-ca1'
    Highcharts.setOptions({
        global: {
            useUTC: false
        }
    });
    Highcharts.chart('container', {
        chart: {
            type: 'spline',
            animation: Highcharts.svg,
						zoomType: 'xy',
            marginRight: 10
        },
        title: {
            text: 'Distance'
        },
        xAxis: {
            type: 'datetime',
            tickPixelInterval: 150
        },
        yAxis: {
            title: {
                text: 'Value'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            formatter: function () {
                return '<b>' + this.series.name + '</b><br/>' +
                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                    Highcharts.numberFormat(this.y, 2);
            }
        },
        legend: {
            enabled: false
        },
        exporting: {
            enabled: false
        },
				series: [{
	  	      name: 'Distance data',
	  	      data: data
	  	   }]
    });
    Highcharts.chart('container2', {
      chart: {
          type: 'areaspline',
          animation: Highcharts.svg,
          marginRight: 10
      },
      title: {
          text: 'Temperature'
      },
      xAxis: {
          type: 'datetime',
          tickPixelInterval: 150
      },
      yAxis: {
          title: {
              text: 'Value'
          },
          plotLines: [{
              value: 0,
              width: 1,
              color: '#808080'
          }]
      },
      tooltip: {
          formatter: function () {
              return '<b>' + this.series.name + '</b><br/>' +
                  Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                  Highcharts.numberFormat(this.y, 2);
          }
      },
      legend: {
          enabled: false
      },
      exporting: {
          enabled: false
      },
			series: [{
  	      name: 'Temperature data',
  	      data: data
  	   }]
    });
    Highcharts.chart('container3', {
      chart: {
          type: 'spline',
          animation: Highcharts.svg,
          marginRight: 10
      },
      title: {
          text: 'Light Level'
      },
      xAxis: {
          type: 'datetime',
          tickPixelInterval: 150
      },
      yAxis: {
          title: {
              text: 'Value'
          },
          plotLines: [{
              value: 0,
              width: 1,
              color: '#808080'
          }]
      },
      tooltip: {
          formatter: function () {
              return '<b>' + this.series.name + '</b><br/>' +
                  Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                  Highcharts.numberFormat(this.y, 2);
          }
      },
      legend: {
          enabled: false
      },
      exporting: {
          enabled: false
      },
      series: [{
  	      name: 'Light Level data',
  	      data: light_data
  	   }]
    });

    dweetio.get_all_dweets_for(name, function(err, dweets){
  	    for(theDweet in dweets.reverse())
  	    {
  	        var dweet = dweets[theDweet];

  	        val = dweet.content["distance", "temperature", "light_level"]
  			data.push(parseInt(val))
  	    }
  		//console.log(data)

  	   var json = {};
  	   json.chart = chart;
  	   json.title = title;
  	   json.tooltip = tooltip;
  	   json.xAxis = xAxis;
  	   json.yAxis = yAxis;
  	   json.legend = legend;
  	   json.exporting = exporting;
  	   json.series = series;
  	   json.plotOptions = plotOptions;

  	   $('#container').highcharts(json);
  		chart = $('#container').highcharts()

      $('#container2').highcharts(json);
  	  chart = $('#container2').highcharts()

  		$('#container3').highcharts(json);
  	  chart = $('#container3').highcharts()
  	});

    dweetio.listen_for(name, function(dweet){
  	    val = dweet.content["distance"]
  			console.log("Distance Update: ", val)
				dist_data.push(val);
  			var chart = $('#container').highcharts();
  			chart.series[0].addPoint(parseInt(val));

        val = dweet.content["temperature"]
  			console.log("Temperature Update: ", val)
				temp_data.push(val);
  			var chart = $('#container2').highcharts();
  			chart.series[0].addPoint(parseInt(val));

  			val = dweet.content["light_level"]
  			console.log("Light Level Update: ", val)
				light_data.push(val);
  			var chart = $('#container3').highcharts();
  			chart.series[0].addPoint(parseInt(val));

				console.log(dist_data)
				console.log(temp_data)
				console.log(light_data)

				localStorage.setItem('data', JSON.stringify(data));
				var retrievedObject = localStorage.getItem('data');
				//console.log(retrievedObject);
    });
});
</script>
</body>
</html>
